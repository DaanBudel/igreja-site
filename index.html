import React, { useEffect, useMemo, useRef, useState } from "react";
import { motion, useInView, useMotionValue, useSpring, useTransform, useScroll } from "framer-motion";
import { Calendar, Clock, MapPin, Mail, Phone, ChevronDown, ArrowRight, Play, HeartHandshake, Users, BookOpen } from "lucide-react";

// ðŸ‘‰ Pas deze waarden aan voor jouw kerk
const LOGO_URL = "https://scontent-bru2-1.xx.fbcdn.net/v/t39.30808-6/308109550_174812785090674_3243926765759956750_n.png?_nc_cat=106&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=wNHvzVtizeQQ7kNvwFQNqkF&_nc_oc=Admjb0D8UofJxhW4JlPOg1XDCms8DTKEnvX7r2kcYL8XO60Up0I5SVj7GKMPIIjkflolKdqy0HCatjbTPUCKWTUY&_nc_zt=23&_nc_ht=scontent-bru2-1.xx&_nc_gid=IfnSgN19roKW5EmPk3ylig&oh=00_AfXMwG5uVnMbrkeJvQNc8zfkI5Rvcv9pb9I9RhouN8w7Rg&oe=68B659EE";
const CHURCH_NAME = "Jouw Kerk"; // vul naam in
const ACCENT = "sky"; // Tailwind kleurfamilie (bv. sky, blue, indigo)

// Bereken countdown tot volgende zondag 10:30 (Europe/Brussels)
function useNextServiceCountdown() {
  const [now, setNow] = useState(() => new Date());
  useEffect(() => {
    const t = setInterval(() => setNow(new Date()), 1000);
    return () => clearInterval(t);
  }, []);

  const target = useMemo(() => {
    const tzOffsetMinutes = -new Date().getTimezoneOffset(); // lokale offset
    const d = new Date();
    // zet naar komende zondag 10:30
    const day = d.getDay(); // 0=zo
    const diff = (7 - day) % 7; // dagen tot komende zondag
    const next = new Date(d);
    next.setDate(d.getDate() + diff);
    next.setHours(10, 30, 0, 0);
    return next;
  }, [now]);

  const delta = Math.max(0, target.getTime() - now.getTime());
  const s = Math.floor(delta / 1000);
  const days = Math.floor(s / 86400);
  const hours = Math.floor((s % 86400) / 3600);
  const minutes = Math.floor((s % 3600) / 60);
  const seconds = s % 60;

  return { days, hours, minutes, seconds };
}

function useParallax(value, distance) {
  return useTransform(value, [0, 1], [-distance, distance]);
}

function TiltCard({ children }: { children: React.ReactNode }) {
  const ref = useRef<HTMLDivElement>(null);
  const x = useMotionValue(0);
  const y = useMotionValue(0);
  const rx = useTransform(y, [-50, 50], [12, -12]);
  const ry = useTransform(x, [-50, 50], [-12, 12]);
  const d = 300;
  const onMouseMove = (e: React.MouseEvent) => {
    const bounds = ref.current?.getBoundingClientRect();
    if (!bounds) return;
    const px = e.clientX - (bounds.left + bounds.width / 2);
    const py = e.clientY - (bounds.top + bounds.height / 2);
    x.set((px / (bounds.width / 2)) * 50);
    y.set((py / (bounds.height / 2)) * 50);
  };
  const onLeave = () => {
    x.set(0); y.set(0);
  };
  return (
    <motion.div
      ref={ref}
      onMouseMove={onMouseMove}
      onMouseLeave={onLeave}
      style={{ rotateX: rx, rotateY: ry }}
      className="relative rounded-2xl border border-sky-200/50 bg-white/70 backdrop-blur p-6 shadow-xl hover:shadow-2xl transition-shadow duration-300"
    >
      <div className="absolute inset-0 rounded-2xl bg-gradient-to-br from-sky-50/60 via-white/20 to-transparent pointer-events-none"/>
      <div className="relative z-10">{children}</div>
    </motion.div>
  );
}

function Section({ id, title, subtitle, children }: { id: string; title: string; subtitle?: string; children: React.ReactNode; }) {
  const ref = useRef(null);
  const inView = useInView(ref, { once: true, margin: "-20% 0px" });
  return (
    <section id={id} ref={ref} className="relative py-20 scroll-mt-24">
      <div className="absolute inset-0 bg-gradient-to-b from-white via-white to-sky-50/60 -z-10" />
      <div className="max-w-6xl mx-auto px-6">
        <motion.h2
          initial={{ opacity: 0, y: 30 }}
          animate={inView ? { opacity: 1, y: 0 } : {}}
          transition={{ duration: 0.6 }}
          className="text-3xl md:text-4xl font-bold tracking-tight text-sky-900"
        >{title}</motion.h2>
        {subtitle && (
          <motion.p
            initial={{ opacity: 0, y: 20 }}
            animate={inView ? { opacity: 1, y: 0 } : {}}
            transition={{ duration: 0.6, delay: 0.1 }}
            className="mt-2 text-sky-700/80 max-w-2xl"
          >{subtitle}</motion.p>
        )}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={inView ? { opacity: 1, y: 0 } : {}}
          transition={{ duration: 0.6, delay: 0.15 }}
          className="mt-10"
        >
          {children}
        </motion.div>
      </div>
    </section>
  );
}

function Navbar() {
  const [open, setOpen] = useState(false);
  const [active, setActive] = useState("home");

  useEffect(() => {
    const handler = () => {
      const sections = ["home", "over", "diensten", "media", "contact"];
      let current = "home";
      for (const id of sections) {
        const el = document.getElementById(id);
        if (!el) continue;
        const rect = el.getBoundingClientRect();
        if (rect.top <= 80 && rect.bottom >= 80) {
          current = id; break;
        }
      }
      setActive(current);
    };
    handler();
    window.addEventListener("scroll", handler);
    return () => window.removeEventListener("scroll", handler);
  }, []);

  const items = [
    { id: "over", label: "Over ons" },
    { id: "diensten", label: "Diensten" },
    { id: "media", label: "Media" },
    { id: "contact", label: "Contact" },
  ];

  const scrollTo = (id: string) => {
    const el = document.getElementById(id);
    if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    setOpen(false);
  };

  return (
    <div className="fixed top-0 inset-x-0 z-50">
      <div className="mx-auto max-w-6xl px-4">
        <div className="mt-4 flex items-center gap-4 rounded-2xl bg-white/70 backdrop-blur border border-sky-200/60 shadow-md px-4 py-3">
          <button onClick={() => scrollTo("home")} className="flex items-center gap-2">
            <img src={LOGO_URL} alt="Kerk logo" className="h-8 w-8 rounded-md object-contain" />
            <span className="font-bold text-sky-900">{CHURCH_NAME}</span>
          </button>
          <div className="ml-auto hidden md:flex items-center gap-2">
            {items.map((it) => (
              <button
                key={it.id}
                onClick={() => scrollTo(it.id)}
                className={`px-3 py-2 rounded-xl text-sm font-medium transition-colors ${active===it.id ? "bg-sky-600 text-white" : "text-sky-900 hover:bg-sky-100"}`}
              >{it.label}</button>
            ))}
          </div>
          <button onClick={() => setOpen(!open)} className="md:hidden ml-auto inline-flex items-center px-3 py-2 rounded-xl bg-sky-600 text-white">
            Menu
          </button>
        </div>
        {open && (
          <div className="md:hidden mt-2 rounded-2xl bg-white/80 backdrop-blur border border-sky-200/60 shadow-md p-2 flex flex-col gap-2">
            {items.map((it) => (
              <button key={it.id} onClick={() => scrollTo(it.id)} className={`px-3 py-2 rounded-xl text-left ${active===it.id ? "bg-sky-600 text-white" : "text-sky-900 hover:bg-sky-100"}`}>{it.label}</button>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

function Hero() {
  const ref = useRef<HTMLDivElement>(null);
  const { scrollYProgress } = useScroll({ target: ref, offset: ["start start", "end start"] });
  const y1 = useParallax(scrollYProgress, 80);
  const y2 = useParallax(scrollYProgress, 120);
  const opacity = useTransform(scrollYProgress, [0, 0.6], [1, 0.2]);

  return (
    <section id="home" ref={ref} className="relative min-h-[90vh] pt-32 overflow-hidden">
      {/* Achtergrond */}
      <div aria-hidden className="absolute inset-0 -z-10">
        <div className="absolute inset-0 bg-gradient-to-b from-sky-100 via-white to-white" />
        <svg className="absolute -top-48 left-1/2 -translate-x-1/2 w-[1200px] h-[1200px] opacity-30" viewBox="0 0 800 800">
          <defs>
            <radialGradient id="g" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stopColor="#38bdf8" />
              <stop offset="60%" stopColor="#38bdf8" stopOpacity="0.25" />
              <stop offset="100%" stopColor="#ffffff" stopOpacity="0" />
            </radialGradient>
          </defs>
          <circle cx="400" cy="400" r="400" fill="url(#g)" />
        </svg>
      </div>

      <div className="max-w-6xl mx-auto px-6 grid md:grid-cols-2 gap-10 items-center">
        <motion.div style={{ y: y1, opacity }} className="relative">
          <div className="inline-flex items-center gap-2 rounded-full bg-white/80 backdrop-blur border border-sky-200 px-3 py-1 text-sky-900 mb-4 shadow">
            <Calendar className="h-4 w-4" />
            <span className="text-sm">Komende dienst: zondag 10:30</span>
          </div>
          <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight text-sky-900">
            Welkom bij <span className="text-sky-600">{CHURCH_NAME}</span>
          </h1>
          <p className="mt-4 text-sky-800/80 text-lg max-w-xl">
            Een warme gemeenschap waar Jezus centraal staat. Samen aanbidden, samen groeien, samen dienen.
          </p>
          <div className="mt-6 flex flex-wrap gap-3">
            <a href="#diensten" className="inline-flex items-center gap-2 rounded-xl bg-sky-600 text-white px-5 py-3 font-medium shadow hover:shadow-lg transition">
              Plan je bezoek <ArrowRight className="h-4 w-4" />
            </a>
            <a href="#media" className="inline-flex items-center gap-2 rounded-xl border border-sky-300 text-sky-900 px-5 py-3 font-medium bg-white/70 hover:bg-sky-50 transition">
              Bekijk livestream <Play className="h-4 w-4" />
            </a>
          </div>

          <div className="mt-8 grid grid-cols-3 gap-4 max-w-lg">
            <TiltCard><div className="flex items-center gap-3"><HeartHandshake className="h-6 w-6 text-sky-600" /><div><div className="font-semibold text-sky-900">Welkom</div><div className="text-sm text-sky-700/80">Iedereen is geliefd</div></div></div></TiltCard>
            <TiltCard><div className="flex items-center gap-3"><Users className="h-6 w-6 text-sky-600" /><div><div className="font-semibold text-sky-900">Gemeenschap</div><div className="text-sm text-sky-700/80">Samen sterker</div></div></div></TiltCard>
            <TiltCard><div className="flex items-center gap-3"><BookOpen className="h-6 w-6 text-sky-600" /><div><div className="font-semibold text-sky-900">Woord</div><div className="text-sm text-sky-700/80">Bijbel-gefundeerd</div></div></div></TiltCard>
          </div>
        </motion.div>

        <motion.div style={{ y: y2, opacity }} className="relative md:justify-self-end">
          <div className="relative">
            <div className="absolute -inset-6 bg-sky-200/50 blur-2xl rounded-3xl" />
            <div className="relative rounded-3xl border border-sky-200 overflow-hidden shadow-2xl">
              <img src={LOGO_URL} alt="Kerk logo" className="w-full h-full object-contain bg-white p-10" />
            </div>
          </div>
        </motion.div>
      </div>

      <div className="absolute left-1/2 -translate-x-1/2 bottom-6 hidden md:flex flex-col items-center text-sky-700/70">
        <ChevronDown className="h-6 w-6 animate-bounce" />
        <span className="text-xs">Scroll</span>
      </div>
    </section>
  );
}

function Services() {
  const { days, hours, minutes, seconds } = useNextServiceCountdown();
  const items = [
    { title: "Zondagdienst", time: "Elke zondag 10:30", desc: "Ontmoeting, aanbidding en prediking." },
    { title: "Gebedsavond", time: "Woensdag 19:30", desc: "Samen bidden voor elkaar en de stad." },
    { title: "Jeugd", time: "Vrijdag 19:00", desc: "Voor tieners en jongeren (12â€“18)." },
  ];
  return (
    <Section id="diensten" title="Diensten & bijeenkomsten" subtitle="Plan je bezoek en ontdek wat er deze week gebeurt.">
      <div className="grid md:grid-cols-3 gap-6">
        {items.map((it, i) => (
          <TiltCard key={i}>
            <div className="flex items-start gap-4">
              <div className="p-3 rounded-xl bg-sky-100 text-sky-700"><Clock className="h-5 w-5"/></div>
              <div>
                <h3 className="font-semibold text-sky-900">{it.title}</h3>
                <div className="text-sm text-sky-700/80">{it.time}</div>
                <p className="mt-2 text-sky-800/80">{it.desc}</p>
              </div>
            </div>
          </TiltCard>
        ))}
      </div>

      <div className="mt-10 rounded-2xl border border-sky-200 bg-white/70 backdrop-blur p-6 flex flex-col md:flex-row items-center gap-6">
        <div className="flex-1">
          <div className="text-sm uppercase tracking-wide text-sky-700/70 font-medium">Countdown</div>
          <div className="text-2xl md:text-3xl font-extrabold text-sky-900">Volgende zondagdienst start over:</div>
        </div>
        <div className="grid grid-cols-4 gap-3">
          {[{label:"dagen",v:days},{label:"uren",v:hours},{label:"min",v:minutes},{label:"sec",v:seconds}].map((b, i) => (
            <div key={i} className="text-center">
              <div className="text-3xl font-extrabold text-sky-900 tabular-nums">{String(b.v).padStart(2,'0')}</div>
              <div className="text-xs uppercase text-sky-700/70">{b.label}</div>
            </div>
          ))}
        </div>
      </div>
    </Section>
  );
}

function About() {
  return (
    <Section id="over" title="Over ons" subtitle="Onze missie is Jezus bekendmaken en mensen discipelen in liefde en waarheid.">
      <div className="grid md:grid-cols-2 gap-8 items-center">
        <div>
          <p className="text-sky-800/90 leading-relaxed">
            We zijn een gemeenschap die gelooft in de kracht van het evangelie. We komen samen om God te aanbidden,
            elkaar te bemoedigen en onze stad te dienen. Jong en oud, iedere achtergrond â€“ je bent welkom zoals je bent.
          </p>
          <ul className="mt-6 space-y-3 text-sky-800/90">
            <li className="flex items-start gap-3"><span className="h-2 w-2 mt-2 rounded-full bg-sky-500"/>Bijbelgetrouwe prediking en aanbidding</li>
            <li className="flex items-start gap-3"><span className="h-2 w-2 mt-2 rounded-full bg-sky-500"/>Kleingroepen & discipelschap</li>
            <li className="flex items-start gap-3"><span className="h-2 w-2 mt-2 rounded-full bg-sky-500"/>Betrokken bij de buurt en hulpverlening</li>
          </ul>
        </div>
        <div className="relative">
          <div className="absolute -inset-4 bg-sky-100 blur-2xl rounded-3xl" />
          <div className="relative overflow-hidden rounded-3xl border border-sky-200 bg-white/70 p-6">
            <blockquote className="text-xl md:text-2xl text-sky-900 font-semibold leading-relaxed">
              "Want waar twee of drie in Mijn Naam bijeen zijn, daar ben Ik in hun midden." <span className="text-sky-600">(Matt. 18:20)</span>
            </blockquote>
          </div>
        </div>
      </div>
    </Section>
  );
}

function Media() {
  return (
    <Section id="media" title="Media & Livestream" subtitle="Bekijk de laatste preek of volg live.">
      <div className="grid lg:grid-cols-2 gap-8 items-start">
        <TiltCard>
          <div className="aspect-video w-full overflow-hidden rounded-xl bg-sky-50 border border-sky-200 flex items-center justify-center">
            {/* Vervang de src met jouw YouTube embed link */}
            <iframe
              className="w-full h-full"
              src="https://www.youtube.com/embed/videoseries?si=&list=PL"
              title="YouTube video player"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerPolicy="strict-origin-when-cross-origin"
              allowFullScreen
            />
          </div>
          <div className="mt-4 flex items-center justify-between">
            <div>
              <div className="font-semibold text-sky-900">Laatste preek</div>
              <div className="text-sm text-sky-700/80">Voeg jouw YouTube-link toe</div>
            </div>
            <a href="#contact" className="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-sky-600 text-white font-medium">
              Vraag hulp <ArrowRight className="h-4 w-4"/>
            </a>
          </div>
        </TiltCard>

        <div className="grid sm:grid-cols-2 gap-6">
          {[1,2,3,4].map(i => (
            <div key={i} className="group relative overflow-hidden rounded-2xl border border-sky-200 bg-white/60 p-4">
              <div className="aspect-video rounded-xl bg-gradient-to-br from-sky-50 to-white border border-sky-100 flex items-center justify-center text-sky-700/70">
                Voeg foto/video #{i} toe
              </div>
              <div className="mt-3 font-medium text-sky-900">Gemeente moment #{i}</div>
              <div className="text-sm text-sky-700/80">Korte beschrijvingâ€¦</div>
              <div className="absolute inset-0 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity bg-gradient-to-t from-sky-100/60 to-transparent"/>
            </div>
          ))}
        </div>
      </div>
    </Section>
  );
}

function Contact() {
  return (
    <Section id="contact" title="Bezoek & contact" subtitle="We horen graag van je. Plan je bezoek of stel je vraag.">
      <div className="grid lg:grid-cols-2 gap-8">
        <TiltCard>
          <div className="flex items-start gap-4">
            <div className="p-3 rounded-xl bg-sky-100 text-sky-700"><MapPin className="h-5 w-5"/></div>
            <div>
              <div className="font-semibold text-sky-900">Adres</div>
              <div className="text-sky-800/80">Straatnaam 1, 1000 Brussel (pas aan)</div>
              <div className="mt-4">
                <iframe
                  title="Map"
                  className="w-full h-64 rounded-xl border border-sky-200"
                  src="https://www.openstreetmap.org/export/embed.html?bbox=4.34878%2C50.845%2C4.36%2C50.85&layer=mapnik"
                />
              </div>
            </div>
          </div>
        </TiltCard>

        <TiltCard>
          <form onSubmit={(e)=>{e.preventDefault(); alert('Bedankt! We nemen spoedig contact op. (Voeg later back-end toe)');}} className="space-y-4">
            <div className="flex items-start gap-4">
              <div className="p-3 rounded-xl bg-sky-100 text-sky-700"><Mail className="h-5 w-5"/></div>
              <div className="flex-1 grid gap-4">
                <div className="grid md:grid-cols-2 gap-4">
                  <input required placeholder="Naam" className="w-full rounded-xl border border-sky-200 bg-white/70 px-4 py-3 outline-none focus:ring-4 focus:ring-sky-200" />
                  <input required type="email" placeholder="E-mail" className="w-full rounded-xl border border-sky-200 bg-white/70 px-4 py-3 outline-none focus:ring-4 focus:ring-sky-200" />
                </div>
                <input placeholder="Telefoon (optioneel)" className="w-full rounded-xl border border-sky-200 bg-white/70 px-4 py-3 outline-none focus:ring-4 focus:ring-sky-200" />
                <textarea required placeholder="Bericht" rows={4} className="w-full rounded-xl border border-sky-200 bg-white/70 px-4 py-3 outline-none focus:ring-4 focus:ring-sky-200" />
                <button className="inline-flex items-center gap-2 self-start rounded-xl bg-sky-600 text-white px-5 py-3 font-medium shadow hover:shadow-lg">Verstuur <ArrowRight className="h-4 w-4"/></button>
              </div>
            </div>
          </form>
        </TiltCard>
      </div>

      <div className="mt-8 grid sm:grid-cols-3 gap-6">
        <div className="rounded-2xl border border-sky-200 bg-white/70 p-5">
          <div className="text-sm uppercase tracking-wide text-sky-700/70">E-mail</div>
          <a href="mailto:info@jouwkerk.be" className="mt-1 block font-semibold text-sky-900">info@jouwkerk.be</a>
        </div>
        <div className="rounded-2xl border border-sky-200 bg-white/70 p-5">
          <div className="text-sm uppercase tracking-wide text-sky-700/70">Telefoon</div>
          <a href="tel:+3212345678" className="mt-1 block font-semibold text-sky-900">+32 12 34 56 78</a>
        </div>
        <div className="rounded-2xl border border-sky-200 bg-white/70 p-5">
          <div className="text-sm uppercase tracking-wide text-sky-700/70">Adres</div>
          <div className="mt-1 font-semibold text-sky-900">Straatnaam 1, 1000 Brussel</div>
        </div>
      </div>
    </Section>
  );
}

function Footer() {
  return (
    <footer className="relative overflow-hidden">
      <div className="absolute inset-0 -z-10 bg-gradient-to-t from-sky-100 via-white to-white" />
      <div className="max-w-6xl mx-auto px-6 py-12 flex flex-col md:flex-row items-center gap-6">
        <div className="flex items-center gap-3">
          <img src={LOGO_URL} alt="Kerk logo" className="h-10 w-10 rounded-md object-contain" />
          <div>
            <div className="font-bold text-sky-900">{CHURCH_NAME}</div>
            <div className="text-sm text-sky-700/80">Â© {new Date().getFullYear()} â€“ Alle rechten voorbehouden</div>
          </div>
        </div>
        <div className="md:ml-auto flex flex-wrap gap-3 text-sm text-sky-700/80">
          <a href="#over" className="hover:text-sky-900">Over</a>
          <a href="#diensten" className="hover:text-sky-900">Diensten</a>
          <a href="#media" className="hover:text-sky-900">Media</a>
          <a href="#contact" className="hover:text-sky-900">Contact</a>
        </div>
      </div>
    </footer>
  );
}

export default function ChurchSite() {
  useEffect(() => {
    document.documentElement.classList.add("scroll-smooth");
  }, []);

  return (
    <div className="min-h-screen font-[system-ui] bg-white text-sky-950">
      <Navbar />
      <Hero />
      <About />
      <Services />
      <Media />
      <Contact />
      <Footer />
    </div>
  );
}
